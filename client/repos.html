<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Your Repositories - Git GUI</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body { background: #181818; color: #e0e0e0; font-family: 'Segoe UI', monospace, Arial, sans-serif; margin: 0; }
        .repos-container {
            max-width: 600px;
            margin: 4em auto;
            background: #23272e;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            padding: 2em 2.5em;
        }
        h2 { color: #00ff00; text-align: center; }
        ul { list-style: none; padding: 0; }
        li { margin: 1.5em 0; }
        .repo-link {
            display: block;
            background: #222c36;
            color: #e0e0e0;
            text-decoration: none;
            padding: 1em 1.5em;
            border-radius: 6px;
            font-size: 1.1em;
            transition: background 0.2s;
        }
        .repo-link:hover { background: #00ff00; color: #181818; }
        .create-repo {
            margin: 2em 0;
            display: flex;
            gap: 1em;
        }
        .create-repo input {
            flex: 1;
            padding: 0.7em;
            border: none;
            border-radius: 4px;
            background: #222;
            color: #e0e0e0;
            font-size: 1em;
        }
        .create-repo button {
            padding: 0.7em 1.5em;
            background: #00ff00;
            color: #181818;
            border: none;
            border-radius: 4px;
            font-size: 1em;
            cursor: pointer;
        }
        .create-repo button:hover { background: #00cc00; }
        .logout-btn {
            display: block;
            margin: 2em auto 0 auto;
            background: #ff5555;
            color: #fff;
            border: none;
            border-radius: 4px;
            padding: 0.7em 2em;
            font-size: 1em;
            cursor: pointer;
        }
        .logout-btn:hover { background: #ff2222; }
    </style>
</head>
<body>
    <div class="repos-container">
        <h2>Your Repositories</h2>
        <div class="create-repo">
            <input type="text" id="newRepoName" placeholder="New repository name" />
            <button onclick="createRepo()">Create Repository</button>
        </div>
        <ul id="repoList">Loading...</ul>
        <button class="logout-btn" onclick="logout()">Logout</button>
    </div>
    <script src="js/api.js"></script>
    <script>
        async function loadRepos() {
            const repoList = document.getElementById('repoList');
            repoList.innerHTML = '<li>Loading...</li>';
            try {
                const res = await apiGet('/api/repos');
                if (!res || !res.length) {
                    repoList.innerHTML = '<li>No repositories found.</li>';
                    return;
                }
                repoList.innerHTML = res.map(r => 
                    `<li><a class='repo-link' href="repo.html?repo_id=${encodeURIComponent(r.id)}">${r.name}</a></li>`
                ).join('');
            } catch (e) {
                console.error('Error loading repos:', e);
                repoList.innerHTML = '<li>Failed to load repositories.</li>';
            }
        }

        async function createRepo() {
            const nameInput = document.getElementById('newRepoName');
            const name = nameInput.value.trim();
            if (!name) {
                alert('Please enter a repository name');
                return;
            }
            try {
                await apiPost('/api/repos', { name, user_id: currentUserId });
                nameInput.value = '';
                loadRepos(); // Refresh the list
            } catch (e) {
                console.error('Error creating repo:', e);
                alert('Failed to create repository. Please try again.');
            }
        }

        function logout() {
            currentUserId = null;
            window.location.href = 'dashboard.html';
        }
        
        loadRepos(); // Load repositories when page loads
    </script>
</body>
</html>
